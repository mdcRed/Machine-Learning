---
title: "Machine Learning Model Predicting How People Exercise"
author: "My D. Coyne"
date: "May 19, 2015"
output: 
  html_document:
    fig_caption: yes
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```



# Executive Summary

To be added

# Abstract

# Preprocess

## Library Require

```{r, echo=TRUE}
library(caret)

library(randomForest)

library(e1071)
```
## Read Training and Testing Data into the workspace

Read both training and testing datasets from files.  

```{r, echo=TRUE}
options(stringsAsFactors = FALSE)

# Training filename and dataframe contains training data
trainingFn <- "../data/pml-training.csv"
trainingDf<- data.frame(read.csv(trainingFn,na.strings=c("NA",""),header=TRUE))

# Testing filenmae and dataframe contains testing data
testingFn <- "../data/pml-testing.csv"
testingDf<- data.frame(read.csv(testingFn,header=TRUE))

```

The input training dataset contains 19,622 rows with 160 variables.

```{r, echo=TRUE}

dim(trainingDf)

```

The test dataset contains 20 rows with 160 variables as well.

```{r, echo=TRUE}

dim(testingDf)

```

## Cleaning Training and Testing data

Examine the data in both training and testing dataset, the observations are:

0.  All data points are numeric, except for the column labeled "classe", which contains "A", "B", "C", "D", "E"

1.  Many columns contains *mostly* NA's; such variables should be removed as part of data cleaning, as the variables will not contribute to 

```{r, echo=TRUE}

# Consider only colum
trCleanDf.wk   <- trainingDf[, colMeans(is.na(trainingDf))   < 0.96]

```

2.  Reviewing the column names of column 1 - 7 reveals that these variables do not contribute to the model.  Hence, the variables are used in building the model will consist the 8th column and thereafter.


```{r, echo=TRUE}
colnames(trainingDf)[1:7]

## trainingDf contains all columns with numeric and classes
trCleanDf.wk<- trCleanDf.wk[,8:dim(trCleanDf.wk)[2]]
```

3.  Performing the same cleaning process with the testing dataset, i.e. remove columns that contains mostly NA's and columns that do not contribute to building of the models.

```{r,echo=TRUE}

tsCleanDf.wk   <- testingDf[, colMeans(is.na(testingDf))   < 0.96]
## numeric data from column 8 to the next to last column

colnames(testingDf)[1:7]

colnames(testingDf)[dim(testingDf)[2]]

tsCleanDf.wk <- tsCleanDf.wk[,8:dim(tsCleanDf.wk)[2]-1]

```


# Random Forest Model and Prediction

Building a model using Random Forest algorithm

```{r, echo=TRUE}

classe.rf.model <- randomForest (as.factor(trCleanDf.wk$classe) ~ .
                                 , trCleanDf.wk
                                 , ntree=100
                                 #, proximity=TRUE
                                 #, keep.forest = FALSE
                                 ## , importance=TRUE
                                 , norm.votes=FALSE
                                )
```

Using the model to predict the test data
 
```{r,echo=TRUE}
pred <- predict (classe.rf.model, tsCleanDf.wk );

print(pred)
```

For convenience of the submission process, the **write_prediction()** function that writes each prediction to a file.

```{r, echo=TRUE}

write_prediction = function(x){
  n = length(x)
  for(i in 1:n){
    filename = paste0("../output/problem_id_",i,".txt")
    write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)
  }
}

# write prediction to a file, ready for submission.
write_prediction(pred);
```

# Validation

## Estimate of Error of the Classifier and Confusion Matrix

```{r, echo=TRUE, fig.cap='Random Forest Model - Error rate vs the number of trees'}
classe.rf.model

plot(classe.rf.model)

```

## Importance of Variables

```{r, echo=TRUE}
varImpPlot(classe.rf.model, class="A", main="Class = A Importance");

varImpPlot(classe.rf.model, class="B", main="Class = B Importance");

varImpPlot(classe.rf.model, class="C", main="Class = C Importance");

varImpPlot(classe.rf.model, class="D", main="Class = D Importance");

varImpPlot(classe.rf.model, class="E", main="Class = E Importance");
```

# Conclusion

# References

1. Ugulino, W.; Cardador, D.; Vega, K.; Velloso, E.; Milidiu, R.; Fuks, H. **Wearable Computing: Accelerometers' Data Classification of Body Postures and Movements.** Proceedings of 21st Brazilian Symposium on Artificial Intelligence. Advances in Artificial Intelligence - SBIA 2012. In: Lecture Notes in Computer Science. , pp. 52-61. Curitiba, PR: Springer Berlin / Heidelberg, 2012. ISBN 978-3-642-34458-9. DOI: 10.1007/978-3-642-34459-6_6.

Read more: http://groupware.les.inf.puc-rio.br/har#ixzz3ac1yTLFa




